# Блокирующий TCP чат

# Протокол

При использовании протокола подразумевается последовательность действий:

- установка соединения , выполняется сразу при подключение
- передача данных , происходит после установки соединения и до закрытия соединения
- закрытие соединения , данное действие может быть выполненно только если выполненно действие установки соединенеия , последнее действие которое может быть выполненно 

 Пакет для передачи сообщений:
 - первые 8 байт сообщения это заголовок 
   - 1 байт - размер никнейна
   - 2 байт - размер поля времени
   - 3-5 байты - размер сообщения
   - 6-8 байты - размер передаваемого файла
  - дальше идет содержание сообщения , которое содержит следующие поля
    - nickname
    - time
    - text
    - file
    
Максимальный размер text и file 16Мб , поля nickname , time , text - это строки в кодировке UTF-8

### Установка соединения

На данном этапе клиент посылает на сервер сообщение , в котором в полях nickname указано имя пользователя который хочет подключиться , в поле time указывается временная зона клиента. Со стороны сервера для каждого нового подключения создаётся сокет и сохраняется его временная зона. Если клиент с таким именем уже существует сервер посылает сообщение клиенту с text - "Такой пользователь уже существует" и отключает клиента.Если с именнем все хорошо , то сервер отсылает всем подключенным клиентам сообщение c text - "Пользователь nickname вошел в чат", после чего клиент может общаться.

### Передача данных

 - Клиент - Сервер
Когда клиент посылает сообщение на сервер пакет заполняется следующим образом:
   - nickname - пустое поле
   - time - пустое поле
   - text - в данное поле запесывается текст сообщения которое хочет отправить пользователь , если отправляется файл то в данное поле записывается имя файла
   - file - в данное поле помещается файл при отправке файла , если файл не отправляется то поле пустое
 - Сервер - Клиент
При передаче сообщения от сервера к клиенту:
   - nickname - записывается имя клиента который отправил сообщение
   - time - записывается время отправки сообщения в соответсвие с временной зонной клиента
   - text - в данное поле запесывается текст сообщения которое отправил клиент , если отправляется файл то в данное поле записывается имя файла
   - file - в данное поле помещается файл который отправил клиент , если файл не отправляется то поле пустое

### Завершение соединения

Если клиент отправляет сообщение с text -  stop то сервер закрывает соединение с данным клиентом






